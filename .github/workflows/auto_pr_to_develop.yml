name: Auto Pull Request (Feature -> Develop)

# This workflow runs whenever a commit is pushed to any branch 
# that matches the 'feature/' naming convention.
on:
  push:
    branches:
      # Target all branches starting with 'feature/' (e.g., feature/login, feature/new-design)
      - 'feature/**' 

jobs:
  create_pull_request:
    runs-on: ubuntu-latest
    
    steps:
      - name: Debug - Print Branch Name
        run: |
          echo "Current Branch Ref: ${{ github.ref }}"
          echo "Current Branch Name: ${{ github.ref_name }}"

      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          # fetch-depth: 0 is important for creating PRs
          fetch-depth: 0 

      - name: Create or Update Pull Request to Develop
        id: cpr
        # This action automatically creates a PR if one doesn't exist, or updates it if it does.
        uses: peter-evans/create-pull-request@v6
        with:
          # Set the destination branch to 'develop'
          base: develop 
          # Use the branch that triggered the push as the source
          head: ${{ github.ref_name }} 
          # The title for the PR
          title: 'Feature: ${{ github.ref_name }} ready for review'
          # Body for the PR
          body: |
            This Pull Request was automatically created by GitHub Actions.
            
            - **Branch:** `${{ github.ref_name }}`
            - **Author:** `${{ github.actor }}`
            
            Please fill in the details of the feature/fix and request reviewers.
          # Assign a unique token that has permission to create PRs
          token: ${{ secrets.GITHUB_TOKEN }}
          # IMPORTANT FIX: Setting this to 'true' ensures the action does not try to 
          # create a new commit or branch, and instead immediately checks for an existing PR 
          # between HEAD (feature/something) and BASE (develop).
          skip-ci: true
          
      - name: PR Status Check
        # Check the output of the create-pull-request action
        if: steps.cpr.outputs.pull-request-number
        run: |
          echo "Pull Request #${{ steps.cpr.outputs.pull-request-number }} created/updated."
          echo "PR URL: ${{ steps.cpr.outputs.pull-request-url }}"
