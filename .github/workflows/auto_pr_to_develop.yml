name: Auto Pull Request (Feature -> Develop)

# This workflow runs whenever a commit is pushed to any branch 
# that matches the 'feature/' naming convention.
on:
  push:
    branches:
      # Target all branches starting with 'feature/' (e.g., feature/login, feature/new-design)
      - 'feature/**' 

jobs:
  create_pull_request:
    runs-on: ubuntu-latest
    
    steps:
      # 1. No need to checkout the repository!
      # We only need the branch reference, which is available via ${{ github.ref_name }}
      
      - name: Debug - Print Branch Name
        run: |
          echo "Current Branch Ref: ${{ github.ref }}"
          echo "Current Branch Name: ${{ github.ref_name }}"

      - name: Create or Update Pull Request to Develop
        id: cpr
        # This action automatically creates a PR if one doesn't exist, or updates it if it does.
        uses: peter-evans/create-pull-request@v6
        with:
          # Set the destination branch to 'develop'
          base: develop 
          
          # Use the 'branch' input to specify the source branch for the PR.
          # This forces the action to use the remote branch that triggered the workflow.
          branch: ${{ github.ref_name }} 
          
          # IMPORTANT: We must also provide a blank commit-message when skipping checkout,
          # otherwise it tries to use its internal default logic which causes issues.
          commit-message: '' 
          
          # The title for the PR
          title: 'Feature: ${{ github.ref_name }} ready for review'
          # Body for the PR
          body: |
            This Pull Request was automatically created by GitHub Actions.
            
            - **Branch:** `${{ github.ref_name }}`
            - **Author:** `${{ github.actor }}`
            
            Please fill in the details of the feature/fix and request reviewers.
          # Assign a unique token that has permission to create PRs
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: PR Status Check
        # Check the output of the create-pull-request action
        if: steps.cpr.outputs.pull-request-number
        run: |
          echo "Pull Request #${{ steps.cpr.outputs.pull-request-number }} created/updated."
          echo "PR URL: ${{ steps.cpr.outputs.pull-request-url }}"
