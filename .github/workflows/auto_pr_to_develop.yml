name: Auto Pull Request (Feature -> Develop)

# This workflow runs whenever a commit is pushed to any branch 
# that matches the 'feature/' naming convention.
on:
  push:
    branches:
      # Target all branches starting with 'feature/' (e.g., feature/login, feature/new-design)
      - 'feature/**' 

jobs:
  create_pull_request:
    runs-on: ubuntu-latest
    
    steps:
      # 1. CHECKOUT: We must checkout the code so the runner is in a Git repository 
      # and the action's internal Git commands don't crash.
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          # fetch-depth: 0 is important for creating PRs
          fetch-depth: 0 
      
      - name: Debug - Print Branch Name
        run: |
          echo "Current Branch Ref: ${{ github.ref }}"
          echo "Current Branch Name: ${{ github.ref_name }}"

      - name: Create or Update Pull Request to Develop
        id: cpr
        # This action automatically creates a PR if one doesn't exist, or updates it if it does.
        uses: peter-evans/create-pull-request@v6
        with:
          # Set the destination branch to 'develop'
          base: develop 
          
          # FIX: This critical input tells the action to use the existing branch 
          # (${{ github.ref_name }}) as the PR head, overriding its default commit-creation 
          # logic and preventing the "no longer differs" error.
          pull-request-branch-name: ${{ github.ref_name }} 
          
          # The title for the PR
          title: 'Feature: ${{ github.ref_name }} ready for review'
          # Body for the PR
          body: |
            This Pull Request was automatically created by GitHub Actions.
            
            - **Branch:** `${{ github.ref_name }}`
            - **Author:** `${{ github.actor }}`
            
            Please fill in the details of the feature/fix and request reviewers.
          # Assign a unique token that has permission to create PRs
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: PR Status Check
        # Check the output of the create-pull-request action
        if: steps.cpr.outputs.pull-request-number
        run: |
          echo "Pull Request #${{ steps.cpr.outputs.pull-request-number }} created/updated."
          echo "PR URL: ${{ steps.cpr.outputs.pull-request-url }}"
